/**
 * 游戏HUD样式 - 移动端优化版
 * 符合专业游戏工作室开发标准
 */

/* ==================== 根容器 ==================== */
.hud-root {
  position: absolute;
  inset: 0;
  pointer-events: none;
  font-family: 'Digital-7', 'Orbitron', 'Inter', sans-serif;
  color: var(--color-safe);
  text-transform: uppercase;
  text-shadow: 0 0 6px var(--color-safe-glow);
  
  /* 性能优化 */
  isolation: isolate;
  will-change: contents;
  
  /* 安全区域适配 */
  padding-top: var(--safe-margin-top);
  padding-right: var(--safe-margin-right);
  padding-bottom: var(--safe-margin-bottom);
  padding-left: var(--safe-margin-left);
}

/* ==================== 层级系统 ==================== */
.hud-layer {
  position: absolute;
  z-index: var(--z-hud-info);
  pointer-events: none;
  
  /* 性能优化 */
  contain: layout style paint;
  will-change: transform;
}

/* ==================== 顶部层 (玩家状态 + 阶段信息) ==================== */
.hud-layer--top {
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  padding: var(--space-4);
  gap: var(--space-4);
}

/* ==================== 右下层 (战斗簇) ==================== */
.hud-layer--right {
  bottom: 0;
  right: 0;
  z-index: var(--z-hud-controls);
}

/* ==================== 玩家状态 ==================== */
.hud-player-status {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  min-width: clamp(120px, 20vw, 200px);
  align-items: flex-start;
}

.hud-player-faction {
  font-size: var(--font-size-sm);
  letter-spacing: 0.08em;
  opacity: 0.8;
}

.hud-player-status .hud-teammates {
  margin-top: var(--space-3);
}

/* ==================== 阶段信息 ==================== */
.hud-stage-info {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
  padding: var(--space-3) var(--space-4);
  border: var(--border-width-base) solid var(--color-info-border);
  background: var(--color-background-alpha);
  backdrop-filter: var(--backdrop-blur-sm);
  letter-spacing: 0.08em;
  border-radius: var(--border-radius-base);
}

.hud-stage-info__name {
  font-size: var(--font-size-sm);
  color: var(--color-info);
}

.hud-stage-info__timer {
  font-size: var(--font-size-xl);
  color: var(--color-text-primary);
  text-shadow: 0 0 8px var(--color-info-glow);
}

/* ==================== 智能消息 ==================== */
.hud-smart-messages {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  max-width: min(400px, 50vw);
}

.hud-smart-messages__item {
  padding: var(--space-2) var(--space-3);
  border-left: var(--border-width-thick) solid var(--color-warning);
  background: rgba(24, 19, 3, 0.85);
  color: var(--color-warning);
  letter-spacing: 0.08em;
  font-size: var(--font-size-sm);
  border-radius: var(--border-radius-sm);
  
  /* 动画 */
  animation: slideDown 300ms var(--easing-out);
  
  /* 性能优化 */
  will-change: transform, opacity;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px) translateZ(0);
  }
  to {
    opacity: 1;
    transform: translateY(0) translateZ(0);
  }
}

/* ==================== 队友状态列表 ==================== */
.hud-teammates {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  max-height: clamp(200px, 30vh, 300px);
  overflow: hidden;
}

.hud-teammate {
  display: flex;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-3);
  background: var(--color-background-alpha);
  border: var(--border-width-base) solid rgba(57, 255, 20, 0.25);
  backdrop-filter: var(--backdrop-blur-sm);
  max-width: 100%;
  border-radius: var(--border-radius-base);
  
  /* 性能优化 */
  contain: layout style paint;
}

.hud-teammate__avatar {
  width: clamp(28px, 5vmin, 36px);
  height: clamp(28px, 5vmin, 36px);
  flex-shrink: 0;
  background: rgba(57, 255, 20, 0.35);
  border: var(--border-width-base) solid rgba(57, 255, 20, 0.5);
  border-radius: var(--border-radius-sm);
}

.hud-teammate__info {
  flex: 1;
  min-width: 0;
}

.hud-teammate__name {
  font-size: var(--font-size-xs);
  letter-spacing: 0.08em;
  margin-bottom: var(--space-1);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.hud-teammate__health-track {
  height: clamp(4px, 1vmin, 6px);
  background: rgba(12, 18, 28, 0.8);
  border: var(--border-width-thin) solid rgba(57, 255, 20, 0.35);
  overflow: hidden;
  border-radius: var(--border-radius-full);
  
  /* 性能优化 */
  contain: strict;
}

.hud-teammate__health-fill {
  height: 100%;
  background: linear-gradient(90deg, rgba(57, 255, 20, 0.9), rgba(102, 255, 178, 0.9));
  
  /* 使用transform动画 */
  transform: scaleX(var(--teammate-health-percent, 1)) translateZ(0);
  transform-origin: left center;
  transition: transform var(--transition-base) var(--easing-out);
  
  /* GPU加速 */
  will-change: transform;
}

.hud-teammate__hint {
  margin-top: var(--space-1);
  font-size: var(--font-size-xs);
  color: var(--color-warning);
}

/* 队友状态变体 */
.hud-teammate--wounded {
  border-color: var(--color-warning-border);
}

.hud-teammate--incapacitated {
  border-color: var(--color-danger-border);
  animation: hud-alert 1s infinite alternate;
}

.hud-teammate--controlled {
  border-color: rgba(160, 99, 255, 0.65);
  animation: hud-alert 0.75s infinite alternate;
}

.hud-teammate--highlight {
  box-shadow: 0 0 16px var(--color-warning-glow);
}

@keyframes hud-alert {
  from { filter: brightness(1); }
  to { filter: brightness(1.35); }
}

/* ==================== 战斗按钮簇 ==================== */
.hud-combat {
  display: flex;
  flex-direction: column;
  gap: var(--touch-gap-comfortable);
  pointer-events: auto;
}

.hud-button {
  position: relative;
  min-width: var(--button-size-secondary);
  min-height: var(--touch-target-min);
  padding: var(--space-3) var(--space-4);
  font-size: var(--font-size-base);
  letter-spacing: 0.12em;
  border: var(--border-width-base) solid var(--color-safe-border);
  background: var(--color-background-alpha);
  color: var(--color-safe);
  cursor: pointer;
  border-radius: var(--border-radius-base);
  
  /* 移除触摸延迟 */
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  
  /* 动画 */
  transition: 
    transform var(--transition-fast) var(--easing-out),
    box-shadow var(--transition-base) var(--easing-out);
  
  /* 性能优化 */
  pointer-events: auto;
  will-change: transform;
  backface-visibility: hidden;
  transform: translateZ(0);
}

.hud-button:active {
  transform: scale(0.96) translateZ(0);
  box-shadow: 0 0 18px var(--color-safe-glow);
}

.hud-button.disabled,
.hud-button:disabled {
  opacity: 0.45;
  cursor: not-allowed;
  pointer-events: none;
}

.hud-button--primary {
  min-width: var(--button-size-primary);
  min-height: var(--touch-target-comfortable);
  font-size: var(--font-size-lg);
  background: rgba(12, 20, 32, 0.82);
  border-color: rgba(57, 255, 140, 0.85);
  box-shadow: var(--glow-safe);
}

.hud-button--secondary {
  font-size: var(--font-size-sm);
  border-color: var(--color-info-border);
  color: var(--color-info);
  box-shadow: var(--glow-info);
}

.hud-button__label {
  display: block;
  pointer-events: none;
}

.hud-button__badge {
  display: inline-block;
  margin-top: var(--space-2);
  padding: var(--space-1) var(--space-2);
  font-size: var(--font-size-xs);
  color: #0b0f16;
  background: var(--color-warning);
  border-radius: var(--border-radius-sm);
}

.hud-button__progress-ring {
  position: absolute;
  inset: 6px;
  border-radius: var(--border-radius-base);
  background: conic-gradient(
    rgba(147, 197, 253, 0.85) calc(var(--progress, 0) * 360deg),
    rgba(12, 20, 32, 0.35) 0deg
  );
  opacity: 0.55;
  pointer-events: none;
  
  /* GPU加速 */
  will-change: background;
  transform: translateZ(0);
}

.hud-button.is-reloading {
  border-color: rgba(147, 197, 253, 0.85);
}

/* ==================== 情境交互 ==================== */
.hud-context {
  position: absolute;
  right: 0;
  top: 50%;
  transform: translateY(-50%) translateZ(0);
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  pointer-events: auto;
  z-index: var(--z-hud-context);
  
  /* 动画 */
  animation: fadeIn 300ms var(--easing-out);
  
  /* 性能优化 */
  will-change: transform, opacity;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-50%) scale(0.9) translateZ(0);
  }
  to {
    opacity: 1;
    transform: translateY(-50%) scale(1) translateZ(0);
  }
}

.hud-context__button {
  padding: var(--space-4) var(--space-5);
  border: var(--border-width-base) solid var(--color-warning-border);
  background: rgba(32, 24, 4, 0.85);
  color: var(--color-warning);
  letter-spacing: 0.1em;
  position: relative;
  cursor: pointer;
  border-radius: var(--border-radius-base);
  min-height: var(--touch-target-comfortable);
  
  /* 触摸优化 */
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  user-select: none;
  
  /* 动画 */
  transition: transform var(--transition-fast) var(--easing-out);
  
  /* 性能优化 */
  will-change: transform;
  transform: translateZ(0);
}

.hud-context__button:active {
  transform: scale(0.96) translateZ(0);
}

.hud-context__label {
  font-size: var(--font-size-base);
  display: block;
}

.hud-context__description {
  display: block;
  margin-top: var(--space-2);
  font-size: var(--font-size-xs);
  color: rgba(255, 231, 158, 0.92);
}

.hud-context__progress {
  position: absolute;
  inset: 6px;
  border: var(--border-width-base) solid var(--color-warning-border);
  border-radius: var(--border-radius-base);
  background: conic-gradient(
    rgba(255, 183, 0, 0.85) calc(var(--progress, 0) * 360deg),
    rgba(32, 24, 4, 0.35) 0deg
  );
  opacity: 0.55;
  pointer-events: none;
  
  /* GPU加速 */
  will-change: background;
  transform: translateZ(0);
}

.hud-context__hint {
  font-size: var(--font-size-xs);
  color: rgba(255, 231, 158, 0.9);
  letter-spacing: 0.08em;
  padding: var(--space-2);
  background: rgba(32, 24, 4, 0.6);
  border-radius: var(--border-radius-sm);
}

/* ==================== 响应式优化 ==================== */

/* 小屏设备 - 紧凑布局 */
@media (max-width: 374px) {
  .hud-layer--top {
    padding: var(--space-2);
    gap: var(--space-2);
  }
  
  .hud-player-status {
    min-width: 160px;
  }
  
  .hud-smart-messages {
    max-width: 40vw;
  }
}

/* 触摸设备优化 */
@media (hover: none) and (pointer: coarse) {
  /* 增大所有可点击元素的触摸区域 */
  .hud-button::before,
  .hud-context__button::before {
    content: '';
    position: absolute;
    inset: calc(var(--touch-gap-min) * -1);
    /* 扩大触摸区域但不影响视觉 */
  }
}
